<!DOCTYPE html>
<html lang="en">

<head>
    <title>Vanilla JS Example</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.min.css" />
</head>

<body>
    <main>
        <div>
            <h1>Vanilla JS Example</h1>
            <hr />
            <button id="fetch-users">Fetch Users</button>
            <select hidden id="gender-filter">
                <option value="">All</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
        </div>
        <table id="tbl-users">
            <thead>
                <tr>
                    <th>Photo</th>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>Tel</th>
                    <th>Age <button hidden id="sort-age-toggle" value="no">â‡…</button></th>
                    <th>Genre</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </main>

    <script>
        // Fill the table with https://randomuser.me/api/?results=20 when clicking the `fetch-users` button
        // Add Age column
        // Add gender column, with two different emojis
        // Filter user by gender
        // Sort user by age
        // Search user by name
        // Add users instead of replacing them.

        const tbody = document.querySelector("#tbl-users tbody");
        let users = [];

        const fetchUsers = async () => {
            try {
                const response = await fetch("https://randomuser.me/api/?results=20");

                if (!response.ok) {
                    throw new Error(`Erreur lors de la rÃ©cupÃ©ration des utilisateurs : ${response.status} ${response.statusText}`);
                }

                const data = await response.json();

                return data.results;
            } catch (error) {
                console.log(`Une erreur est survenue : ${error.message}`);
                return [];
            }
        }

        const buildUserRow = (users) => {
            tbody.innerHTML = users.map((user) =>  {
                return `<tr>
                            <td><img src="${user.picture.thumbnail}" alt="User Photo"></td>
                            <td>${user.name.first} ${user.name.last}</td>
                            <td>${user.email}</td>
                            <td>${user.phone}</td>
                            <td>${user.dob.age}</td>
                            <td>${user.gender === 'male' ? 'ðŸ‘¨' : 'ðŸ‘©'}</td>
                        </tr>`;
            }).join('');
        }

        document.getElementById("fetch-users").addEventListener("click", async () => {
            users = await fetchUsers();
            buildUserRow(users);

            document.getElementById("gender-filter").hidden = false;
            document.getElementById("sort-age-toggle").hidden = false;
        });

        document.getElementById("gender-filter").addEventListener("change", async () => {
            const selectedGender = document.getElementById("gender-filter").value;

            const filteredUsers = selectedGender
            ? users.filter(user => user.gender === selectedGender)
            : users;

            buildUserRow(filteredUsers);
        });

        document.getElementById('sort-age-toggle').addEventListener('click', () => {
            const asc = document.getElementById('sort-age-toggle').value;
            let ageFilter = [...users];
            switch (asc) {
                case 'no':
                    ageFilter.sort((a, b) => a.dob.age - b.dob.age);
                    document.getElementById('sort-age-toggle').value = 'asc';
                    break;
                case 'asc':
                    ageFilter.sort((a, b) => b.dob.age - a.dob.age);
                    document.getElementById('sort-age-toggle').value = 'desc';
                    break;
                default:
                    document.getElementById('sort-age-toggle').value = 'no';
                    ageFilter = [...users];
            }

            document.getElementById('gender-filter').value = '';
            buildUserRow(ageFilter);
        });

    </script>
</body>

</html>